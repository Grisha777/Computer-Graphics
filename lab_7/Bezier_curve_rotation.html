<HTML>
    <BODY>
    <canvas id="lab09" width="700" height="700" style="border:1px solid" >
    </canvas>
    <script>
     function Line(ctx, x0, y0, x1, y1)
        {
                var dy = Math.abs(y1-y0);
                var dx = Math.abs(x1-x0);
                var dmax = Math.max(dx, dy);
                var dmin = Math.min(dx, dy);
                var xdir = 1;
                if (x1<x0) 
                {
                    xdir = -1;
                }	
                var ydir = 1;
                if (y1<y0) 
                {
                    ydir = -1;
                }
                var eps = 0;
                var s = 1;
                var k=2*dmin;
                if (dy<=dx) 
                {
                    var y = y0;
                    for (var x=x0; x*xdir<=x1*xdir; x= x + xdir) 
                    {
                        ctx.fillRect(x*s, y*s, 1*s, 1*s);
                        eps = eps+k;
                        if (eps>dmax) 
                        {
                            y= y + ydir;
                            eps = eps - 2*dmax;
                        }	
                    } 
                } else {
                    var x = x0;
                    for (var y=y0; y*ydir<=y1*ydir; y= y + ydir) 
                    {
                        ctx.fillRect(x*s, y*s, 1*s, 1*s);
                        eps = eps+k;
                        if (eps>dmax)
                        {
                            x= x + xdir;
                            eps = eps - 2*dmax;
                        }	
                    } 
                }		
            }
    </script>
    <script>
        var canvas = document.getElementById("lab09");
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "red";
        var state = 0;
        var ax, ay;
        var bx, by;
        var p1x, p1y;
        var p2x, p2y;
        var points = [];
        var counter = 0;

        function distance(P0, P1, P2)
        {
            var k = (P2[1] - P0[1])/(P2[0] - P0[0]);
            var b = -1*k*P0[0] + P0[1];
            d = Math.abs(-k*P1[0] + P1[1] -1*b)/Math.sqrt(k*k + 1);
            console.log('Coef', k);
            console.log('Distance ',d);
            return d
        }

        function Bezier(P0, P1, P2)
        {

            if(distance(P0, P1, P2) > 1)
            {
                P0_ = []; // x0' y0'
                P0_[0] = 0.5*P0[0] + 0.5*P1[0];
                P0_[1] = 0.5*P0[1] + 0.5*P1[1];
                P1_ = []; // x1' y1'
                P1_[0] = 0.5*P1[0] + 0.5*P2[0];
                P1_[1] = 0.5*P1[1] + 0.5*P2[1];
                P0__ = []; // x0" y0"
                P0__[0] = 0.5*P0_[0] + 0.5*P1_[0];
                P0__[1] = 0.5*P0_[1] + 0.5*P1_[1];
                Line(ctx, P0_[0], P0_[1], P1_[0], P1_[1]);
                Bezier(P0, P0_, P0__);
            }else{
                Line(ctx, P0_[0], P0_[1], P1_[0], P1_[1]);
            }
        }

        function Bezier_2(P0, P1, P2)
        {
            if(distance(P0, P1, P2) > 1)
            {
                P0_ = []; // x0' y0'
                P0_[0] = 0.5*P0[0] + 0.5*P1[0];
                P0_[1] = 0.5*P0[1] + 0.5*P1[1];
                P1_ = []; // x1' y1'
                P1_[0] = 0.5*P1[0] + 0.5*P2[0];
                P1_[1] = 0.5*P1[1] + 0.5*P2[1];
                P0__ = []; // x0" y0"
                P0__[0] = 0.5*P0_[0] + 0.5*P1_[0];
                P0__[1] = 0.5*P0_[1] + 0.5*P1_[1];
                Line(ctx, P0_[0], P0_[1], P1_[0], P1_[1]);
                Bezier_2(P0__, P1_, P2);
            }else{
                Line(ctx, P0_[0], P0_[1], P1_[0], P1_[1]);
            }
        }

        function Rotation(V,E)
        {
            var res = [];
            for (var i = 0; i < 3; i++)
            {
                res.push(0);
                for (var j = 0; j < 3; j++)
                {
                    res[i] = res[i] + V[i*3+j] * E[j];
                }
            }
            return res;
        }

        canvas.addEventListener("click", function(event)
        {
            if(counter < 3)
            {
                points.push([event.offsetX, event.offsetY]);
                ctx.fillRect(event.offsetX, event.offsetY, 2, 2);
                counter++;
            }else{
                var P0_new = [];
                var P2_new = [];
                P0 = points[0];
                P1 = points[1];
                P2 = points[2];
                P0_new[0] = P0[0];
                P0_new[1] = P0[1];
                P2_new[0] = P2[0];
                P2_new[1] = P2[1];
                Bezier(P0, P1, P2);
                Bezier_2(P0, P1, P2);

                for(var i = 0; i < 360; i = i + 10)
                {
                    var alpha = i*Math.PI/180;
                    P0_new[0] = P0_new[0] - P1[0];
                    P0_new[1] = P0_new[1] - P1[1];
                    P2_new[0] = P2_new[0] - P1[0];
                    P2_new[1] = P2_new[1] - P1[1];
                    var V = [Math.cos(alpha), -1*Math.sin(alpha), 0, Math.sin(alpha), Math.cos(alpha), 0, 0, 0, 1];
                    var out = Rotation(V, [P0_new[0], P0_new[1], 1]);
                    console.log(out);
                    P0_new[0] = out[0] + P1[0];
                    P0_new[1] = out[1] + P1[1];
                    out = Rotation(V, [P2_new[0], P2_new[1], 1]);
                    console.log(out);
                    P2_new[0] = out[0] + P1[0];
                    P2_new[1] = out[1] + P1[1];
                    Bezier(P0_new, P1, P2_new);
                    Bezier_2(P0_new, P1, P2_new);
                    P0_new[0] = P0[0];
                    P0_new[1] = P0[1];
                    P2_new[0] = P2[0];
                    P2_new[1] = P2[1];
                }
                counter = 0;
                points = [];
            }
        });
</script>
</BODY>
</HTML>